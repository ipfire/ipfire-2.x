From: Zhu Yi <yi.zhu@intel.com>
Subject: ipw2200: fix oops in ipw_tx_skb
Patch-mainline: not yet
References: bnc#397390

Fixes Oops in ipw2200:ipw_tx_skb when pinging through
a WPA enterprise connection.

Signed-off-by: Zhu Yi <yi.zhu@intel.com>
Tested-by: Frank Seidel <fseidel@suse.de>
Signed-off-by: Ffrank Seidel <fseidel@suse.de>

---
 drivers/net/wireless/ipw2200.c |    5 +++++
 1 file changed, 5 insertions(+)

--- a/drivers/net/wireless/ipw2200.c
+++ b/drivers/net/wireless/ipw2200.c
@@ -10206,6 +10206,11 @@ static int ipw_tx_skb(struct ipw_priv *p
 	u16 remaining_bytes;
 	int fc;
 
+	if (!(priv->status & STATUS_ASSOCIATED)) {
+		IPW_DEBUG_TX("Tx attempt while not associated.\n");
+		goto drop;
+	}
+
 	hdr_len = ieee80211_get_hdrlen(le16_to_cpu(hdr->frame_ctl));
 	switch (priv->ieee->iw_mode) {
 	case IW_MODE_ADHOC:
