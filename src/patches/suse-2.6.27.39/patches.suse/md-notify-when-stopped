From: NeilBrown <neilb@suse.de>
Subject: md: notify udev when an md array is stopped.
Patch-mainline: 2.6.28-rc3

When an md array is stopped we need to udev to remove any
(/dev/disk/by-id/md*) links.  Otherwise /dev can become a bit of a
mess.

Signed-off-by: Neil Brown <neilb@suse.de>

---
 drivers/md/md.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -3996,6 +3996,8 @@ static int do_md_stop(mddev_t * mddev, i
 		mddev->barriers_work = 0;
 		mddev->safemode = 0;
 
+		kobject_uevent(&mddev->gendisk->dev.kobj, KOBJ_CHANGE);
+
 	} else if (mddev->pers)
 		printk(KERN_INFO "md: %s switched to read-only mode.\n",
 			mdname(mddev));
